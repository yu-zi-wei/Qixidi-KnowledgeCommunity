<template>
  <div class="mt-10 mb-40 overflow-hidden">
    <div class="mb-10">
      <hr class="hr-wavy">
    </div>
    <div style="padding: 0 10px">
      <!--    搜索-->
      <!--    <div class="text-center">-->
      <!--      <div class="search-box" tabindex="1">-->
      <!--        <input v-model="queryParams.address" type="text" class="search-txt" placeholder="拍摄地点..."-->
      <!--               style="color:#636e72;outline:none;"/>-->
      <!--        <a class="search-btn">-->
      <!--          <svg t="1671602595081" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"-->
      <!--               p-id="1401" width="16" height="16">-->
      <!--            <path-->
      <!--                d="M953.474215 908.234504l-152.576516-163.241391c61.92508-74.48211 95.81186-167.36973 95.81186-265.073744 0-229.294809-186.63531-415.930119-416.102133-415.930119-229.294809 0-415.930119 186.63531-415.930119 415.930119s186.63531 415.930119 415.930119 415.930119c60.032925 0 118.00168-12.55703 172.186125-37.327062 16.169326-7.396607 23.221905-26.318159 15.825298-42.315471-7.396607-16.169326-26.318159-23.221905-42.315471-15.825298-45.927768 20.813707-94.951789 31.478582-145.695952 31.478582-194.031917 0-351.94087-157.908953-351.94087-351.94087 0-194.031917 157.908953-351.94087 351.94087-351.94087 194.031917 0 351.94087 157.908953 351.94087 351.94087 0 91.339493-34.918864 177.86259-98.048043 243.743995-12.213002 12.729044-11.868974 33.026709 0.860071 45.239711 1.032085 0.860071 2.236183 1.204099 3.268268 2.064169 0.860071 1.204099 1.376113 2.752226 2.408198 3.956325l165.477574 177.00252c6.192508 6.70855 14.793214 10.148833 23.393919 10.148833 7.912649 0 15.653284-2.92424 21.845792-8.600706C964.827146 941.433227 965.515202 921.135562 953.474215 908.234504z"-->
      <!--                fill="#ffffff" p-id="1402"></path>-->
      <!--          </svg>-->
      <!--        </a>-->
      <!--      </div>-->
      <!--    </div>-->
      <a-spin :loading="loading" tip="正在赶来的路上..." style="width: 100%;" :size="28">
        <div class="" v-if="imgList.length!=0">
          <div class="content">
            <div class="img-div" v-for="(item,index) in imgList" :key="index">
              <!--              {{index}}-->
              <a-image
                  class="cursor-pointer"
                  :title="item.remarks==null?parseTimes(item.createTime, '{y}-{m}-{d}'):item.remarks"
                  show-loader
                  :preview-visible="item.states"
                  @preview-visible-change="() => { item.states= false }"
                  :src="item.img">
                <template #extra>
                  <div class="loader-animate"/>
                  <div class="actions">
                    <a-tooltip content="查看大图">
                                <span class="action" @click="() => { item.states = true }">
                                  <svg t="1686483795317" class="icon cursor-pointer mr-4" viewBox="0 0 1024 1024"
                                       version="1.1"
                                       xmlns="http://www.w3.org/2000/svg" p-id="2465" width="20" height="20"><path
                                      d="M928.842245 512.091074c0-5.006014-0.846274-9.193383-1.086751-9.691733-0.182149-2.480494-1.028423-7.001461-1.815345-9.374508-0.210801-0.590448-0.484024-1.209548-0.724501-1.799996-0.424672-1.360997-0.876973-2.691295-1.390673-3.749394-76.871785-168.137395-242.376213-281.144168-411.782507-281.144168-169.375595 0-334.865697 112.902396-411.388535 280.130072-0.921999 1.815345-1.572822 3.553942-1.981121 5.066389-0.181125 0.49835-0.39295 0.967024-0.558725 1.406023-1.512447 4.430916-1.542122 7.514137-1.421372 6.712889-0.710175 3.251044-1.360997 9.722432-1.360997 9.722432-0.181125 1.949398-0.181125 3.50687 0.030699 5.442966 0 0 0.649799 5.65479 0.968048 6.80294 0.090051 1.602498 0.483001 3.931542 0.951675 6.048763l-0.030699 0c0.408299 1.814322 0.968048 3.568269 1.738597 5.291516 0.393973 1.330298 0.862647 2.570545 1.270946 3.507894 76.976162 168.166047 242.436588 281.20352 411.781484 281.20352 169.436994 0 334.941422-112.945375 410.936233-279.328823 1.177825-2.177596 1.935072-4.233418 2.448772-6.018064 0.2415-0.543376 0.454348-1.027399 0.604774-1.511423 1.331321-3.872191 1.602498-7.227612 1.481747-7.227612l-0.028653 0.029676C928.027693 520.921183 928.842245 516.89959 928.842245 512.091074zM872.717993 514.146896c-0.029676 0.121773-0.091074 0.272199-0.151449 0.393973-0.090051 0.36225-0.240477 0.785899-0.332575 1.209548-68.403926 147.420561-212.830293 246.337431-360.191502 246.337431-146.997935 0-291.168476-98.642624-360.252901-246.578931-0.166799-0.5137-0.287549-0.998747-0.468674-1.481747-0.030699-0.484024-0.12075-0.876973-0.150426-1.150196-0.060375-0.300852-0.12075-0.724501-0.166799-1.088798l0-0.3776c0.166799-0.620124 0.286526-1.239224 0.347924-1.919722 0.12075-0.36225 0.211824-0.710175 0.347924-1.103124C220.132094 360.89042 364.680235 261.928524 512.041444 261.928524c147.420561 0 291.940049 99.051947 360.161826 246.322082 0.060375 0.287549 0.121773 0.530073 0.212848 0.726547 0.060375 0.2415 0.119727 0.484024 0.240477 0.740874 0.151449 1.104147 0.272199 2.192945 0.423649 2.736321C872.899118 513.028423 872.809067 513.572822 872.717993 514.146896z"
                                      fill="#ffffff" p-id="2466"></path><path
                                      d="M512.041444 373.060601c-76.598562 0-138.954749 62.325487-138.954749 138.939399 0 76.598562 62.356187 138.954749 138.954749 138.954749 76.598562 0 138.954749-62.356187 138.954749-138.954749C650.996193 435.386088 588.640006 373.060601 512.041444 373.060601zM512.041444 595.372849c-45.935192 0-83.371826-37.406958-83.371826-83.371826 0-45.950542 37.436634-83.356476 83.371826-83.356476 45.964868 0 83.373873 37.406958 83.373873 83.356476C595.414293 557.965891 558.006312 595.372849 512.041444 595.372849z"
                                      fill="#ffffff" p-id="2467"></path></svg>

                                </span>
                    </a-tooltip>
                    <a-tooltip :content="item.address">
                                  <span class="action">
                                    <svg t="1686484247077" class="icon mr-4" viewBox="0 0 1024 1024" version="1.1"
                                         xmlns="http://www.w3.org/2000/svg" p-id="5855" width="20" height="20"><path
                                        d="M512 146.112776c-155.194618 0-281.452183 121.521704-281.452183 270.873244 0 49.519834 14.047947 98.006128 41.023322 140.820236l220.98195 309.748646c4.365424 6.469342 11.661597 10.332323 19.446911 10.332323 7.810896 0 15.102976-3.886517 19.445888-10.332323l221.528396-310.563198c26.474978-42.120306 40.4779-90.534969 40.4779-139.987265C793.452183 267.63448 667.198711 146.112776 512 146.112776L512 146.112776zM512 568.291051c-77.723176 0-140.726092-63.009056-140.726092-140.726092 0-77.723176 63.002916-140.726092 140.726092-140.726092 77.722152 0 140.726092 63.002916 140.726092 140.726092C652.726092 505.283018 589.722152 568.291051 512 568.291051L512 568.291051zM512 568.291051"
                                        fill="#ffffff" p-id="5856"></path></svg>
                                  </span>
                    </a-tooltip>
                    <a-tooltip :content="parseTimes(item.createTime, '{y}-{m}-{d}')">
                                  <span class="action">
                                   <svg t="1686484280141" class="icon" viewBox="0 0 1024 1024" version="1.1"
                                        xmlns="http://www.w3.org/2000/svg" p-id="6997" width="20" height="20"><path
                                       d="M893.090118 161.585486H715.041579V90.562657c0-15.423809-12.491401-27.929544-27.929544-27.929544-15.437119 0-27.929544 12.505735-27.929543 27.929544v71.022829H390.473003V90.562657c0-15.423809-12.491401-27.929544-27.929544-27.929544s-27.929544 12.505735-27.929544 27.929544v71.022829H126.400691c-34.883773 0-63.277137 28.37903-63.277137 63.277137v647.36276c0 34.898107 28.393364 63.277137 63.277137 63.277137h766.689427c34.883773 0 63.277137-28.37903 63.277137-63.277137V224.862623c0-34.898107-28.39234-63.277137-63.277137-63.277137z m7.419073 710.639897a7.427264 7.427264 0 0 1-7.419073 7.419073H126.400691a7.427264 7.427264 0 0 1-7.419073-7.419073V224.862623a7.427264 7.427264 0 0 1 7.419073-7.419073h208.214248v64.695218c0 15.423809 12.491401 27.929544 27.929544 27.929544s27.929544-12.505735 27.929544-27.929544v-64.695218h268.709488v64.695218c0 15.423809 12.491401 27.929544 27.929544 27.929544 15.437119 0 27.929544-12.505735 27.929544-27.929544v-64.695218h178.048539a7.427264 7.427264 0 0 1 7.419073 7.419073v647.36276z"
                                       fill="#ffffff" p-id="6998"></path><path
                                       d="M288.497096 478.723727m-51.822932 0a51.822932 51.822932 0 1 0 103.645864 0 51.822932 51.822932 0 1 0-103.645864 0Z"
                                       fill="#ffffff" p-id="6999"></path><path
                                       d="M517.278129 478.723727m-51.822932 0a51.822932 51.822932 0 1 0 103.645864 0 51.822932 51.822932 0 1 0-103.645864 0Z"
                                       fill="#ffffff" p-id="7000"></path><path
                                       d="M746.060185 478.723727m-51.822932 0a51.822932 51.822932 0 1 0 103.645864 0 51.822932 51.822932 0 1 0-103.645864 0Z"
                                       fill="#ffffff" p-id="7001"></path><path
                                       d="M288.497096 680.997392m-51.822932 0a51.822932 51.822932 0 1 0 103.645864 0 51.822932 51.822932 0 1 0-103.645864 0Z"
                                       fill="#ffffff" p-id="7002"></path><path
                                       d="M517.278129 680.997392m-51.823956 0a51.823956 51.823956 0 1 0 103.647912 0 51.823956 51.823956 0 1 0-103.647912 0Z"
                                       fill="#ffffff" p-id="7003"></path><path
                                       d="M746.060185 680.997392m-51.823955 0a51.823956 51.823956 0 1 0 103.647911 0 51.823956 51.823956 0 1 0-103.647911 0Z"
                                       fill="#ffffff" p-id="7004"></path></svg>
                                  </span>
                    </a-tooltip>
                  </div>
                </template>
              </a-image>
            </div>
          </div>
        </div>
        <div v-if="imgList.length==0 && !loading" class="text-center" style="color: #fefefe;font-size: 18px">
          <svg t="1670079174437" class="icon" viewBox="0 0 1567 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
               p-id="11978" width="54" height="54">
            <path
                d="M156.662278 699.758173h21.097186A10.444152 10.444152 0 0 1 187.994733 710.202325c0 5.765172-4.490985 10.444152-10.235269 10.444152H156.662278v21.097186A10.444152 10.444152 0 0 1 146.218126 751.978932a10.277045 10.277045 0 0 1-10.444152-10.235269V720.646477H114.676787A10.444152 10.444152 0 0 1 104.441518 710.202325c0-5.765172 4.490985-10.444152 10.235269-10.444152H135.773974v-21.097187A10.444152 10.444152 0 0 1 146.218126 668.425717c5.765172 0 10.444152 4.490985 10.444152 10.235269v21.097187z m1378.628042-83.553215v-21.097186A10.277045 10.277045 0 0 0 1524.846168 584.872503a10.444152 10.444152 0 0 0-10.444152 10.235269v21.097186h-21.097186a10.277045 10.277045 0 0 0-10.235269 10.444152c0 5.598065 4.595427 10.444152 10.235269 10.444152h21.097186v21.097187c0 5.744284 4.67898 10.235269 10.444152 10.235268a10.444152 10.444152 0 0 0 10.444152-10.235268V637.093262h21.097187c5.744284 0 10.235269-4.67898 10.235268-10.444152a10.444152 10.444152 0 0 0-10.235268-10.444152H1535.29032zM776.460024 960.861969H250.596979A20.80475 20.80475 0 0 1 229.77134 939.973665c0-11.530344 9.462402-20.888304 20.825639-20.888303h94.728457A83.010119 83.010119 0 0 1 334.212859 877.413196v-605.96969A83.49055 83.49055 0 0 1 417.849627 187.994733H480.430984V167.001988A83.49055 83.49055 0 0 1 564.067752 83.553215h501.152182A83.448773 83.448773 0 0 1 1148.856702 167.001988v605.969689c0 15.185797-4.052331 29.410732-11.133466 41.672166h115.554096c11.551232 0 20.909192 9.274407 20.909192 20.888304 0 11.530344-9.295295 20.888304-20.888304 20.888304H1002.638576v20.992745c0 15.185797-4.052331 29.410732-11.133466 41.672166h11.196131c11.488567 0 20.825639 9.274407 20.825639 20.888303 0 11.530344-9.462402 20.888304-20.825639 20.888304h-109.893365c9.545955 16.000441 7.478013 36.972297-6.41271 50.863019a41.672166 41.672166 0 0 1-59.072122 0L776.460024 960.861969z m76.367638-41.776607h66.424806c22.977134 0 41.609501-18.59059 41.609501-41.881049V270.461756c0-22.559368-18.047494-40.690416-40.314426-40.690416H416.303892c-22.266932 0-40.314426 18.214601-40.314426 40.690416v606.742557c0 23.123352 18.799473 41.881049 41.588613 41.881049h317.084449l-10.736588-10.757477a41.693054 41.693054 0 0 1-10.861918-40.377091l-19.718558-19.739447A146.259902 146.259902 0 0 1 502.363703 627.693525a146.218126 146.218126 0 0 1 220.517822 190.981761l19.739447 19.739447a41.630389 41.630389 0 0 1 40.377091 10.841029L852.827662 919.085362zM1002.638576 814.643843h62.852906A41.797496 41.797496 0 0 0 1107.080095 772.867236V167.106429c0-23.14424-18.632367-41.776607-41.588613-41.776607H563.775316A41.797496 41.797496 0 0 0 522.207592 167.106429v20.888304h396.794216A83.448773 83.448773 0 0 1 1002.638576 271.443506V814.643843zM266.325872 46.998683h31.123572c8.773088 0 15.875111 6.955805 15.875111 15.666228 0 8.647758-7.102023 15.666228-15.875111 15.666228h-31.123572v31.123572c0 8.773088-6.955805 15.875111-15.666228 15.875111a15.770669 15.770669 0 0 1-15.666228-15.875111V78.331139H203.869844A15.728893 15.728893 0 0 1 187.994733 62.664911c0-8.647758 7.102023-15.666228 15.875111-15.666228h31.123572V15.875111c0-8.773088 6.955805-15.875111 15.666228-15.875111 8.647758 0 15.666228 7.102023 15.666228 15.875111v31.123572zM20.888304 939.973665c0-11.530344 9.462402-20.888304 20.825638-20.888303h125.455152c11.488567 0 20.825639 9.274407 20.825639 20.888303 0 11.530344-9.462402 20.888304-20.825639 20.888304H41.713942A20.80475 20.80475 0 0 1 20.888304 939.973665z m658.733544-135.021995a104.441518 104.441518 0 1 0-147.722083-147.722083 104.441518 104.441518 0 0 0 147.722083 147.722083zM459.542681 313.324555a20.888304 20.888304 0 0 1 20.867415-20.888304H710.202325a20.888304 20.888304 0 1 1 0 41.776608H480.430984A20.825639 20.825639 0 0 1 459.542681 313.324555z m0 104.441518c0-11.530344 9.295295-20.888304 20.742085-20.888303h334.505295c11.44679 0 20.742086 9.274407 20.742086 20.888303 0 11.530344-9.295295 20.888304-20.742086 20.888304H480.284766A20.762974 20.762974 0 0 1 459.542681 417.766073z m0 104.441519c0-11.530344 9.316183-20.888304 20.846527-20.888304h146.301679c11.509455 0 20.846527 9.274407 20.846527 20.888304 0 11.530344-9.316183 20.888304-20.846527 20.888303h-146.301679A20.80475 20.80475 0 0 1 459.542681 522.207592zM62.664911 396.87777a62.664911 62.664911 0 1 1 0-125.329822 62.664911 62.664911 0 0 1 0 125.329822z m0-31.332456a31.332456 31.332456 0 1 0 0-62.664911 31.332456 31.332456 0 0 0 0 62.664911zM1357.739739 271.547948a62.664911 62.664911 0 1 1 0-125.329822 62.664911 62.664911 0 0 1 0 125.329822z m0-31.332456a31.332456 31.332456 0 1 0 0-62.664911 31.332456 31.332456 0 0 0 0 62.664911z"
                fill="#ffffff" p-id="11979"></path>
          </svg>
          <div>暂无相册</div>
        </div>
        <div @click="getData" v-if="isList" style="margin: auto;text-align: center;">
          <div class="mt-20">
            <button class="button-bo-cl">
              <span class="fl-left">查看更多</span>
              <span class="fl-left ml-2">...</span>
            </button>
          </div>
        </div>
      </a-spin>
    </div>
  </div>
</template>

<script>
import './css/album.css'
import {listAlbum} from "@/api/lover";
import {downloadByBlob} from "@/utils/imgUitls";
import './css/button.css'
import {parseTime} from "@/utils/dateUitls";

export default {
  name: "albumVue",
  data() {
    return {
      visible1: false,
      imgList: [],
      queryParams: {
        pageNum: 1,
        pageSize: 30,
        state: 0,
        address: null,
      },
      total: 0,
      scrollLoading: true,
      isList: false,
      loading: true,
    }
  },
  watch: {
    'queryParams.address': {
      handler: function () {
        this.listAlbums();
      }
    }
  },
  methods: {
    parseTimes(value, args) {
      return parseTime(value, args);
    },
    //下载图片
    downCom(url, name) {
      downloadByBlob(url, name);
    },
    imgRotate(id) {
      if (id % 3 == 0) {
        return 'transform: rotate(-8deg);'
      }
      if (id % 3 == 1) {
        return 'transform: rotate(12deg);'
      }
      if (id % 3 == 2) {
        return 'transform: rotate(-16deg);'
      }
    },
    getData() {
      let scrollTop = document.documentElement.scrollTop
      let clientHeight = document.documentElement.clientHeight
      let scrollHeight = document.documentElement.scrollHeight
      if (scrollHeight - (scrollTop + clientHeight) <= 1) {
        if (!this.scrollLoading) return;
        if (this.total > (this.queryParams.pageNum) * this.queryParams.pageSize) {
          this.scrollLoading = false;
          this.queryParams.pageNum = this.queryParams.pageNum + 1;
          listAlbum(this.queryParams).then(res => {
            res.rows.forEach(item => {
              this.imgList.push(item)
            })
            this.total = res.total;
          }).finally(() => {
            this.scrollLoading = true
            // this.setUpActive();
            if (this.total > (this.queryParams.pageNum) * this.queryParams.pageSize) {
              this.isList = true;
              return;
            }
            this.isList = false;
          })
        }
      }
    },
    listAlbums() {
      this.queryParams.pageNum = 1;
      listAlbum(this.queryParams).then(res => {
        this.imgList = res.rows;
        this.total = res.total;
        this.loading = false;
        // this.setUpActive();
        if (this.total > (this.queryParams.pageNum) * this.queryParams.pageSize) {
          this.isList = true;
          return;
        }
        this.isList = false;


      })
    },
    setUpActive() {
      // 获取所有.item元素
      let items = document.querySelectorAll('.item');

      // 设置选中态样式
      function setActive() {
        // 遍历所有.item元素，移出active样式
        items.forEach((item) => {
          item.classList.remove('active');
        })
        // 为当前选中项添加active样式
        this.classList.add('active');
      }

      // 遍历所有.item元素，分别为其设置点击事件
      items.forEach((item) => {
        item.addEventListener('click', setActive);
      })

    }
  },
  mounted() {
    this.listAlbums();
  },
  created() {
    //添加滚动监听事件
    window.addEventListener('scroll', this.getData, true);
  },
  unmounted() {
    //离开页面时删除该监听
    window.removeEventListener('scroll', this.getData, true)
  }
}
</script>

<style>
.arco-spin-tip, .arco-spin-icon {
  color: #fefefe;
}

.arco-spin-mask {
  background-color: transparent;
}

.arco-image {
  display: block;
}
.arco-image-footer-caption-title{
  font-size: 0.8rem;
}
</style>
